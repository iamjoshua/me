---
import { getPhotoUrl } from "@/lib/utils";

interface Photo {
  id: string;
  data: {
    filename: string;
    title?: string;
    path: string;
    iso?: number;
    aperture?: number;
    focal_length?: number;
    shutter_speed?: string;
  };
}

interface Props {
  photos: Photo[];
}

const { photos } = Astro.props;
---

{
  photos.length === 0 ? (
    <p class="text-sm text-neutral-500">No photos found.</p>
  ) : (
    <div class="photo-columns">
      {photos.map((photo) => {
        const photoTitle = photo.data.title || photo.data.filename;
        const thumbnailUrl = getPhotoUrl(photo.data.path, { width: 600 });
        const fullUrl = getPhotoUrl(photo.data.path, { width: 2400 });

        const iso = photo.data.iso ? `ISO ${photo.data.iso}` : "";
        const aperture = photo.data.aperture ? `f/${photo.data.aperture}` : "";
        const focalLength = photo.data.focal_length ? `${photo.data.focal_length}mm` : "";
        const shutterSpeed = photo.data.shutter_speed || "";

        return (
          <div
            class="group cursor-pointer overflow-hidden rounded-lg mb-3"
            data-photo-id={photo.id}
            data-image-url={fullUrl}
            data-title={photoTitle}
            data-iso={iso}
            data-aperture={aperture}
            data-focal-length={focalLength}
            data-shutter-speed={shutterSpeed}
            onclick={`openLightboxById('${photo.id}')`}
          >
            <img
              src={thumbnailUrl}
              alt={photoTitle}
              loading="lazy"
              decoding="async"
              class="w-full h-auto transition-transform duration-300 group-hover:scale-105"
            />
          </div>
        );
      })}
    </div>
  )
}

<style>
  .photo-columns {
    column-count: 1;
    column-gap: 12px;
    column-fill: balance;
  }

  @media (min-width: 640px) {
    .photo-columns {
      column-count: 2;
    }
  }

  @media (min-width: 1024px) {
    .photo-columns {
      column-count: 3;
    }
  }

  @media (min-width: 1280px) {
    .photo-columns {
      column-count: 4;
    }
  }

  .photo-columns > * {
    break-inside: avoid;
    display: block;
  }
</style>
