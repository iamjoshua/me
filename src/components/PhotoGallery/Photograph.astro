---
import { Image } from "astro:assets";
import AnimateOnLoad from "../AnimateOnLoad.astro";
import { getPhotoUrl } from "@/lib/utils";

interface Props {
  photo: {
    id: string;
    data: {
      filename: string;
      title: string;
      path: string;
    };
  };
  index: number;
}

const { photo, index } = Astro.props;
const thumbnailUrl = getPhotoUrl(photo.data.path, { width: 400 });
const fullUrl = getPhotoUrl(photo.data.path, { width: 2400 });

// Format EXIF data for display
const iso = photo.data.iso ? `ISO ${photo.data.iso}` : "";
const aperture = photo.data.aperture ? `f/${photo.data.aperture}` : "";
const focalLength = photo.data.focal_length ? `${photo.data.focal_length}mm` : "";
const shutterSpeed = photo.data.shutter_speed || "";
---

<AnimateOnLoad type="slideUp" delay={index * 0.1} class="md:flex-none">
  <div
    class="group cursor-pointer w-full md:w-auto"
    data-photo-id={photo.id}
    data-image-url={fullUrl}
    data-title={photo.data.title}
    data-iso={iso}
    data-aperture={aperture}
    data-focal-length={focalLength}
    data-shutter-speed={shutterSpeed}
    onclick={`openLightboxById('${photo.id}')`}
  >
    <div class="overflow-hidden rounded-lg bg-gray-100">
      <Image
        src={thumbnailUrl}
        alt={photo.data.title}
        width={400}
        height={300}
        class="w-full md:h-66 md:w-auto h-auto object-cover transition-transform duration-300 group-hover:scale-105"
        loading="lazy"
      />
    </div>
  </div>
</AnimateOnLoad>
